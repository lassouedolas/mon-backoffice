const fs = require("fs");
const pdfParse = require("pdf-parse");

async function genererTemplateHTMLDepuisPDF(cheminPDF, fichierHTML) {
  try {
    // Lire et analyser le fichier PDF
    const buffer = fs.readFileSync(cheminPDF);
    const data = await pdfParse(buffer);
    const contenu = data.text; // Texte extrait du PDF

    // Extraction des sections spécifiques
    const resume = contenu.match(/Résumé\s*:\s*(.+?)(?:\n|$)/s)?.[1] || "N/A";
    const fiche = contenu.match(/Fiche technique\s*:\s*((?:- .+\n?)+)/)?.[1] || "";
    const faq = contenu.match(/FAQ\s*:\s*((?:Q\s?:.+\nR\s?:.+\n?)+)/)?.[1] || "";

    const lignesFiche = fiche
      .split("\n")
      .filter(Boolean)
      .map(l => `<li>${l.replace(/^- /, "")}</li>`)
      .join("\n");

    const lignesFAQ = faq
      .split(/Q\s?:/)
      .slice(1)
      .map(bloc => {
        const [question, reste] = bloc.split(/\nR\s?:/);
        const reponse = reste?.trim() || "";
        return `<li><strong>Q :</strong> ${question.trim()}<br><strong>R :</strong> ${reponse}</li>`;
      })
      .join("\n");

    // Générer le template HTML
    const templateHTML = `
<div class="fiche-produit">
  <h2>Résumé</h2>
  <p>${resume}</p>

  <h3>Caractéristiques techniques</h3>
  <ul>
    ${lignesFiche}
  </ul>

  <h3>FAQ</h3>
  <ul>
    ${lignesFAQ}
  </ul>
</div>`.trim();

    // Écrire le contenu HTML dans le fichier
    fs.writeFileSync(fichierHTML, templateHTML, "utf8");
    console.log(`✅ Template HTML créé à partir du PDF : ${fichierHTML}`);
  } catch (error) {
    console.error("❌ Une erreur s'est produite :", error);
  }
}

// Exemple d'utilisation
const cheminPDF = "sorties/samsung_WW90T554DTW_ficheIA.pdf";
const templateSortie = "templates/samsung_WW90T554DTW.html";

genererTemplateHTMLDepuisPDF(cheminPDF, templateSortie);
